  check_coding_style:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/epitech/coding-style-checker:latest

    steps:

    - name: Checkout
      uses: actions/checkout@v3

    - name: Coding style command
      run: check.sh $(pwd) $(pwd)

    - name: Checks if there is any error
      run: |
        file_size=$(stat -c%s "coding-style-reports.log")
        if [ "$file_size" -gt 0 ]; then
          cat "coding-style-reports.log"
          exit 1
        fi

  check_program_compilation:
    timeout-minutes: 2
    runs-on: ubuntu-latest
    needs: check_coding_style
    container:
      image: epitechcontent/epitest-docker 

    steps:

    - name: Checkout
      uses: actions/checkout@v3
    
    - name: Checks make
      run: make

    - name: Clean
      run: make clean

    - name: Check all executables
      run: |
        IFS=', ' read -r -a executables <<< "$EXECUTABLES"
        for executable in "${executables[@]}"; do
            if [ ! -x "$executable" ]; then
                exit 1
            fi
        done

  run_tests:
    timeout-minutes: 2
    runs-on: ubuntu-latest
    needs: check_program_compilation
    container:
      image: epitechcontent/epitest-docker 

    steps:

    - name: Checkout
      uses: actions/checkout@v3
    
    - name: Running tests
      run: make tests_run

